{% load cacheops static post_extras %}
{% cached_as post.reactions.all 3600 post_footer_cache post.pk post.topic.board.preferences.reaction_type request.session.session_key %}
{% if post.topic.board.preferences.reaction_type != 'n' %}
    {% get_has_reacted post request as has_reacted %}
    <div class="card-footer post-card-footer text-muted"
         id="post-{{ post.pk }}-footer"
         hx-get="{% url 'boards:post-footer-fetch' post.topic.board.slug post.pk %}"
         hx-trigger="reactionUpdated"
         hx-target="this"
         hx-swap="outerHTML">
        <form hx-post="{% url 'boards:post-reaction' post.topic.board.slug post.pk %}"
              hx-swap="none"
              id="post-{{ post.pk }}-reaction-form">
            {% csrf_token %}
            <div class="d-flex align-items-center gap-2">
                {% if post.topic.board.preferences.reaction_type == 'l' %}
                    <button class="btn btn-link text-muted shadow-none p-1" type="submit">
                        {% if has_reacted.0 %}
                            <i class="bi bi-heart-fill"></i>
                        {% else %}
                            <i class="bi bi-heart"></i>
                        {% endif %}
                    </button>
                {% elif post.topic.board.preferences.reaction_type == 'v' %}
                    <button class="btn btn-link text-muted shadow-none p-1"
                            type="submit"
                            name="score"
                            value="1">
                        {% if has_reacted.0 and has_reacted.2 == 1 %}
                            <i class="bi bi-hand-thumbs-up-fill"></i>
                        {% else %}
                            <i class="bi bi-hand-thumbs-up"></i>
                        {% endif %}
                    </button>
                    {{ post.get_reaction_score.0 }}
                    <button class="btn btn-link text-muted shadow-none p-1"
                            type="submit"
                            name="score"
                            value="-1">
                        {% if has_reacted.0 and has_reacted.2 == -1 %}
                            <i class="bi bi-hand-thumbs-down-fill"></i>
                        {% else %}
                            <i class="bi bi-hand-thumbs-down"></i>
                        {% endif %}
                    </button>
                    {{ post.get_reaction_score.1 }}
                {% elif post.topic.board.preferences.reaction_type == 's' %}
                    <div id="stars-{{ post.pk }}-div"
                         class="d-flex align-items-center raty-div">{{ post.pk|json_script:"post_pk" }}</div>
                    <button type="submit" name="stars" id="stars-{{ post.pk }}-submit" hidden></button>
                {% endif %}
                {% if post.get_reaction_score and not post.topic.board.preferences.reaction_type == 'v' %}
                    {{ post.get_reaction_score }}
                {% endif %}
            </div>
        </form>
        {{ has_reacted.0|json_script:"has_reacted" }}
        {% if has_reacted.0 %}{{ has_reacted.2|json_script:"reacted_score" }}{% endif %}
    </div>
{% endif %}
{% endcached_as %}
