{% load cache %}
<div class="col-sm"
     id="topic-{{ topic.pk }}"
     hx-get="{% url 'boards:topic-fetch' topic.board.slug topic.pk %}"
     hx-trigger="topicUpdated, postCreated"
     hx-target="this"
     hx-swap="outerHTML">
    <div class="card my-2" id="topic-{{ topic.pk }}-title">
        <div class="card-body">
            {% cache 3600 topic topic.pk %}
            <h5 class="card-title text-break" id="topic-{{ topic.pk }}-subject">{{ topic }}</h5>
        {% endcache %}
        {% if request.user == board.owner or user.is_staff %}
            {% cache 3600 topic-buttons topic.pk %}
            <button id="topic-{{ topic.pk }}-update-url"
                    hx-get="{% url 'boards:topic-update' topic.board.slug topic.pk %}"
                    hx-target="#modal-1-body-div"
                    hx-swap="innerHTML"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-1-div"
                    class="btn btn-link shadow-none text-muted ps-0">
                Edit
            </button>
            <button id="topic-{{ topic.pk }}-delete-url"
                    hx-get="{% url 'boards:topic-delete' topic.board.slug topic.pk %}"
                    hx-target="#modal-1-body-div"
                    hx-swap="innerHTML"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-1-div"
                    class="btn btn-link shadow-none text-danger px-0">
                Delete
            </button>
        {% endcache %}
    {% endif %}
</div>
</div>
{% cache 3600 topic-create-post topic.pk  %}
<div class="card my-2" id="topic-{{ topic.pk }}-create">
    <div class="card-body">
        <button id="topic-{{ topic.pk }}-create-url"
                hx-get="{% url 'boards:post-create' topic.board.slug topic.pk %}"
                hx-target="#modal-1-body-div"
                hx-swap="innerHTML"
                data-bs-toggle="modal"
                data-bs-target="#modal-1-div"
                class="btn btn-link shadow-none card-link">
            <strong>Create post</strong>
        </button>
    </div>
</div>
{% endcache %}
{% for post in topic.posts.all|dictsort:"pk" %}
    {% include 'boards/components/post.html' %}
{% endfor %}
{% cache 3600 topic-newCard topic.pk  %}
<div id="newCard-{{ topic.pk }}-div"
     hx-trigger="postCreated"
     hx-target="this"
     hx-swap="beforebegin"
     hidden
     true></div>
</div>
{% endcache %}
