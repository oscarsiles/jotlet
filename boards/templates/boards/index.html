{% extends "base_generic.html" %}
{% load crispy_forms_tags static cache %}
{% block head %}
    {% if is_all_boards %}
        <link href="{% static 'css/3rdparty/tagify-4.11.0.css' %}" rel="stylesheet"/>
        <script defer src="{% static 'js/3rdparty/tagify-4.11.0.min.js' %}" nonce="{{ CSP_NONCE }}"></script>
        <script defer src="{% static 'js/3rdparty/tagify-4.11.0.polyfills.min.js' %}" nonce="{{ CSP_NONCE }}"></script>
    {% endif %}
    <script defer src="{% static 'boards/js/index.js' %}" nonce="{{ CSP_NONCE }}"></script>
{% endblock head %}
{% block content %}
    <div class="d-md-flex flex-grow-1 px-3">
        <div class="col-md">
            {% if not is_all_boards %}
                <p>{% crispy form %}</p>
            {% endif %}
            {% if request.user.is_authenticated %}
                {% cache 86400 index-list-title request.user is_all_boards %}
                <div class="py-2">
                    <div class="d-flex gap-2">
                        <h4>
                            {% if is_all_boards %}
                                All boards:
                            {% else %}
                                Your boards ({{ request.user }}):
                            {% endif %}
                        </h4>
                        <div class="spinner-border htmx-indicator" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                {{ is_all_boards|json_script:"is_all_boards" }}
                <div id="board-list"
                     hx-get="{% url 'boards:board-list' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML"></div>
            {% endcache %}
        {% endif %}
        {% if perms.boards.can_view_all_boards and not is_all_boards %}
            <p>
                <a class="btn btn-primary" href="{% url 'boards:index-all' %}">All Boards</a>
            </p>
        {% endif %}
    </div>
    <div class="col-md" x-show="!smallWindow"></div>
</div>
{{ request.user.is_authenticated|json_script:"is_logged_in" }}
{% endblock content %}
