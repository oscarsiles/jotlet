{% extends 'base_generic.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% load cache %}
{% block content %}
    {% cache 3600 request.user is_all_boards %}
    <div class="d-sm-flex flex-grow-1 px-2">
        <div class="col-md-4">
            {% if not is_all_boards %}
                <p>
                    {% crispy form %}
                </p>
            {% endif %}
            {% if user.is_authenticated %}
                <div class="py-2">
                    <div class="d-flex gap-2">
                        <h4>
                            {% if is_all_boards %}
                                All boards:
                            {% else %}
                                Your boards ({{ user }}):
                            {% endif %}
                        </h4>
                        <div class="spinner-border htmx-indicator" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="d-grid gap-2">
                        <input class="form-control py-2"
                               id="input-topic-search"
                               type="search"
                               name="b"
                               placeholder="Search by topic/subject..."
                               hx-get="{% url 'boards:board-search' %}"
                               hx-trigger="keyup changed delay:500ms, search"
                               hx-target="#board-list"
                               hx-indicator=".htmx-indicator">
                        {% if is_all_boards %}
                            <input class="form-control"
                                   id="input-user-search"
                                   type="search"
                                   name="u"
                                   placeholder="Search by user..."
                                   hx-get="{% url 'boards:board-search' %}"
                                   hx-trigger="userAdded, userChanged, userRemoved"
                                   hx-target="#board-list"
                                   hx-indicator=".htmx-indicator">
                        {% endif %}
                    </div>
                </div>
                <div id="board-list"
                     hx-get="{% url 'boards:board-search' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML"></div>
            {% endif %}
            {% if perms.boards.can_view_all_boards and not is_all_boards %}
                <p>
                    <a class="btn btn-primary" href="{% url 'boards:index-all' %}">All Boards</a>
                </p>
            {% endif %}
        </div>
    </div>
{% endcache %}
{% endblock content %}
{% block script %}
    <script src="{% static 'js/index.js' %}"></script>
{% endblock script %}
